<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title data-i18n="login.guest_access_request">Guest Access Request</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

    <div class="logo-container">
        <img src="{{ url_for('static', filename='images/logo.svg') }}" alt="Main Logo" class="logo-img">
    </div>

    <h1 id="guestAccessRequest" data-i18n="login.guest_access_request">Guest Access Request</h1>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div class="flash-messages">
                {% for message in messages %}
                    <p class="error">{{ message }}</p>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <form action="{{ url_for('submit') }}" method="post">
        <label id="yourName" for="name" data-i18n="login.your_name">Your Name:</label>
        <input type="text" name="name" required />

        <label id="yourEmail" for="email" data-i18n="login.your_email">Your Email:</label>
        <input type="email" name="email" required />

        <label id="sponsorEmail" for="sponsor_email" data-i18n="login.sponsor_email">Sponsor's Email:</label>
        <input type="email" name="sponsor_email" required />

        <!-- Instruction about sponsor email domain -->
        <p data-i18n="login.sponsor_email_note"></p>

        <button type="submit" id="submitButton" data-i18n="login.submit">Submit</button>
    </form>

    <!-- Footer Section -->
    <div class="footer">
        <p>
            Powered by:
            <a href="https://www.rbtecnologia.com" target="_blank">
                <img src="{{ url_for('static', filename='images/developer_logo.png') }}" alt="Developer Logo" class="footer-img">
            </a>
        </p>
    </div>

    <!-- Language selector in the top-right corner -->
    <div class="language-selector">
        <select id="language-select" onchange="changeLanguage(this.value)">
            <option value="en">English</option>
            <option value="es">Español</option>
            <option value="pt-BR">Português</option>
        </select>
    </div>

    <!-- Load i18next and backend locally from the static/js folder -->
    <script src="{{ url_for('static', filename='js/i18next.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/i18next-http-backend.min.js') }}"></script>

    <!-- Pass allowed sponsor domains to JavaScript -->
    <script>
        var allowedDomains = {{ allowed_domains | tojson }};
    </script>

    <script>
        i18next
            .use(i18nextHttpBackend)
            .init({
                lng: 'en', // Set default language to English
                fallbackLng: {
                    'pt-BR': ['pt-BR'],
                    'default': ['en']
                },
                backend: {
                    loadPath: function(lng, namespaces) {
                        return '/static/locales/' + lng + '.json';
                    },
                    crossDomain: false
                }
            }, function(err, t) {
                if (err) {
                    console.error('i18next error:', err);
                } else {
                    updateContent();
                }
            });

        // Function to update content with translations
        function updateContent() {
            document.querySelectorAll('[data-i18n]').forEach(function(element) {
                const key = element.getAttribute('data-i18n');
                const optionsAttr = element.getAttribute('data-i18n-options');
                let options = {};
                if (optionsAttr) {
                    try {
                        options = JSON.parse(optionsAttr);
                    } catch (e) {
                        console.error('Error parsing data-i18n-options', e);
                    }
                }
                element.innerHTML = i18next.t(key, options);
            });

            // Update the sponsor email note with allowed domains
            const sponsorEmailNote = document.querySelector('[data-i18n="login.sponsor_email_note"]');
            if (sponsorEmailNote) {
                sponsorEmailNote.innerHTML = i18next.t('login.sponsor_email_note', { allowed_domains: allowedDomains.join(', ') });
            }
        }

        // Change language dynamically
        function changeLanguage(lng) {
            i18next.changeLanguage(lng, function(err, t) {
                if (!err) updateContent();
            });
        }

        // Ensure the dropdown is set to the current language on page load
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('language-select').value = i18next.language || 'en';
        });
    </script>
</body>
</html>
